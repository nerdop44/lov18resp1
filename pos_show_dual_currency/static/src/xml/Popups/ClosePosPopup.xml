<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="ClosePosPopup" t-inherit="point_of_sale.ClosePosPopup" t-inherit-mode="extension">
        <xpath expr="//div[hasclass('total-orders')]//span[hasclass('amount')]" position="after">
            <t t-if="pos.config.show_currency_rate!=0">
                <t t-set="trm" t-value="1/pos.config.show_currency_rate"/>
            </t>
            <t t-else="">
                <t t-set="trm" t-value="1"/>
            </t>
            <t t-if="trm!=0">
                <span style="color: red;">/</span>
                <span style="color: red;" t-esc="pos.format_currency_ref(props.orders_details.amount / trm)"/>
            </t>
        </xpath>
        <xpath expr="//span[t-esc='env.utils.formatCurrency(props.default_cash_details.opening)']" position="after">
            <t t-set="trm" t-value="pos.config.show_currency_rate != 0 ? 1/pos.config.show_currency_rate : 1"/>
            <t t-if="trm!=0">
                <span class="ms-1" style="color: red;">
                    / <t t-esc="pos.format_currency_ref(Math.abs(props.default_cash_details.opening) / trm)"/>
                </span>
            </t>
        </xpath>

        <!-- Money Overview (Cash Control) -->
        <xpath expr="//div[hasclass('payment-methods-overview')]/div[1]" position="after">
            <div t-if="pos.config.cash_control" class="w-100 mb-3 border-top pt-2">
                <div class="d-flex align-items-center justify-content-between fs-3" style="color: red;">
                    <span t-esc="props.default_cash_details.default_cash_details_ref.name"/>
                    <span t-esc="pos.format_currency_ref(props.default_cash_details.default_cash_details_ref.amount)"/>
                </div>
                <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2" style="color: red !important;">
                    <span>Currency Ref Opening</span>
                    <span t-esc="pos.format_currency_ref(props.default_cash_details.default_cash_details_ref.opening)"/>
                </div>
                <div t-foreach="props.default_cash_details.default_cash_details_ref.moves" t-as="move" t-key="move_index"
                     class="d-flex align-items-center justify-content-between text-muted border-start ps-2" style="color: red !important;">
                    <span>
                        <t t-esc="move.amount &lt; 0 ? '-' : '+'"/>
                        <t t-esc="move.name"/>
                    </span>
                    <span t-esc="pos.format_currency_ref(Math.abs(move.amount))"/>
                </div>
                <div t-if="props.default_cash_details.default_cash_details_ref.payment_amount"
                     class="d-flex align-items-center justify-content-between text-muted border-start ps-2" style="color: red !important;">
                    <span>Payments in <t t-esc="props.default_cash_details.default_cash_details_ref.name"/></span>
                    <span t-esc="pos.format_currency_ref(Math.abs(props.default_cash_details.default_cash_details_ref.payment_amount))"/>
                </div>
                <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2" style="color: red !important;">
                    <span>Counted (Ref)</span>
                    <span t-esc="pos.format_currency_ref(state.payments_usd[props.default_cash_details.default_cash_details_ref.id].counted)"/>
                </div>
                <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2"
                     t-att-class="{'text-danger fw-bold': state.payments_usd[props.default_cash_details.default_cash_details_ref.id].difference}"
                     style="color: red !important;">
                    <span>Difference (Ref)</span>
                    <span t-esc="pos.format_currency_ref(state.payments_usd[props.default_cash_details.default_cash_details_ref.id].difference)"/>
                </div>
            </div>
        </xpath>

        <!-- Cash Count Input for Ref Currency -->
        <xpath expr="//div[hasclass('notes-container')]" position="before">
            <div t-if="pos.config.cash_control" class="mb-3 border-top pt-2">
                <label class="form-label text-danger" t-esc="props.default_cash_details.default_cash_details_ref.name + ' Count'"/>
                <div class="d-flex w-100 gap-2 mt-1">
                    <Input tModel="[state.payments_usd[props.default_cash_details.default_cash_details_ref.id], 'counted']"
                        callback.bind="(value) => handleInputChangeUSD(props.default_cash_details.default_cash_details_ref.id)"
                        isValid.bind="env.utils.isValidFloat" class="'cash-input w-100 text-danger'"/>
                    <button class="icon fa fa-money btn btn-secondary text-danger" t-on-click="openDetailsPopupUSD" />
                </div>
            </div>
        </xpath>

        <!-- Other payment methods display -->
        <xpath expr="//div[hasclass('payment-methods-overview')]//div[t-foreach]" position="inside">
             <t t-set="trm" t-value="pos.config.show_currency_rate != 0 ? 1/pos.config.show_currency_rate : 1"/>
             <div class="d-flex align-items-center justify-content-between text-muted border-start ps-2" style="color: red !important;">
                <span>In Ref Currency</span>
                <span t-esc="pos.format_currency_ref(pm.amount / trm)"/>
             </div>
        </xpath>

        <!-- Dialog extension for detail popup -->
        <xpath expr="//div[hasclass('notes-container')]" position="after">
            <MoneyDetailsPopupUSD
                    t-if="state.displayMoneyDetailsPopupUSD"
                    manualInputCashCountUSD="manualInputCashCountUSD"
                    onConfirm.bind="updateCountedCashUSD"
                    onDiscard.bind="closeDetailsPopupUSD"
            />
        </xpath>

    </t>
</templates>
